name: Force Build CSAC Router
on:
  workflow_dispatch:
    inputs:
      clean_build:
        description: 'Clean build (remove all caches)'
        required: false
        default: 'false'
        type: boolean
jobs:
  build-csac:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        submodules: true
        fetch-depth: 0
    
    - name: Setup build environment
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential clang flex g++ gawk gcc-multilib gettext git libncurses5-dev libssl-dev python3 python3-distutils rsync unzip zlib1g-dev file wget
    
    - name: Make force_csac_build.sh executable
      run: chmod +x force_csac_build.sh
    
    - name: Force build CSAC firmware
      run: ./force_csac_build.sh
      timeout-minutes: 180
    
    - name: Upload firmware artifacts
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: csac-firmware
        path: bin/targets/ath79/generic/
        retention-days: 7
    
    - name: Upload build logs
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: csac-build-logs
        path: build.log
        retention-days: 7
